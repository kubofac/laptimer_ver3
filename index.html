<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dorrobor_ver3</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<link rel="manifest" href="/manifest.json">

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(registration => {
        console.log('Service Worker registered! Scope:', registration.scope);
      })
      .catch(err => {
        console.log('Service Worker registration failed:', err);
      });
  });
}
</script>


    <style>
        /* 地図コンテナの相対位置指定 */
        #map-container {
            position: relative;
        }

        /* 地図のスタイル */
        #mapid {
            height: 300px;
            width: 100%;
            margin-bottom: 15px;
        }

        /* 地図コントロールのスタイル */
        #map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* 地図コントロール内のボタンのスタイル */
        #map-controls button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 5px;
        }

        /* アクティブなボタンのスタイル */
        #map-controls button.active {
            background-color: #007bff;
            color: white;
        }

        /* body全体のフォントとパディング */
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        /* フォームグループのスタイル */
        .form-group {
            margin-bottom: 15px;
        }

        /* フォームグループ内のラベルのスタイル */
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* 数値入力フィールドのスタイル */
        .form-group input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            width: 200px;
        }

        /* セレクトボックスのスタイル */
        .form-group select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            width: 200px;
        }

        /* フォームグループ内のボタンのスタイル */
        .form-group button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            cursor: pointer;
            margin-right: 5px;
        }

        /* 各種表示テキストのスタイル */
        #setSportkk,
        #setSportkkk,
        #setThresholdValue,
        #setLapCoolDown,
        #gps-frequency {
            margin-top: 10px;
            font-weight: bold;
        }

        /* クリック座標表示のスタイル */
        #clickCoordinates {
            font-weight: bold;
        }

        /* メッセージ表示エリアのスタイル */
        #instructionMessage {
            font-weight: bold;
            min-height: 20px;
        }
    </style>




</head>
<body>

    <div class="form-group">
        <label for="circuitSelect">サーキットを選択:</label>
        <select name="cir" id="circuitSelect">
            <option value="">サーキットを選択</option>
            <option value="0">白糸S</option>
            <option value="1">富士C</option>
            <option value="2">つま恋</option>
            <option value="3">中井C</option>
        </select>
        <p id="setSportkk"></p>
    </div>

    <div id="map-container">
        <div id="mapid"></div>
        <div id="map-controls">
            <button id="setStartPointButton">開始点を配置</button>
            <button id="setEndPointButton" disabled>終了点を配置</button>
        </div>
    </div>
    
    <div class="form-group">
        <p id="instructionMessage"></p>
    </div>

    <div class="form-group">
        <label for="startLineP1Lon">開始点 経度:</label>
        <input type="number" id="startLineP1Lon" placeholder="経度" readonly>
    </div>
    <div class="form-group">
        <label for="startLineP1Lat">開始点 緯度:</label>
        <input type="number" id="startLineP1Lat" placeholder="緯度" readonly>
    </div>
    <div class="form-group">
        <label for="startLineP2Lon">終了点 経度:</label>
        <input type="number" id="startLineP2Lon" placeholder="経度" readonly>
    </div>
    <div class="form-group">
        <label for="startLineP2Lat">終了点 緯度:</label>
        <input type="number" id="startLineP2Lat" placeholder="緯度" readonly>
    </div>

    <div class="form-group">
        <button onclick="saveStartLineCoordinates()">スタートライン座標を保存</button>
    </div>

    <div class="form-group">
        <p>GPS更新頻度: <span id="gps-frequency">計測中...</span> Hz</p>
    </div>

    <div class="form-group">
        <label for="pulseCountSelect">パルス数:</label>
        <select name="pl" id="pulseCountSelect">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="4">4</option>
        </select>
        <p id="setSportkkk"></p>
    </div>

    <div class="form-group">
        <button onclick="savePulseCount()">SET パルス数</button>
    </div>

    <div class="form-group">
        <label for="thresholdSelect">GPS閾値 (メートル):</label>
        <select name="threshold" id="thresholdSelect">
            <option value="10">10m</option>
            <option value="15">15m</option>
            <option value="20">20m</option>
            <option value="25">25m</option>
            <option value="30">30m</option>
            <option value="40">40m</option>
        </select>
        <p id="setThresholdValue"></p>
    </div>

    <div class="form-group">
        <button onclick="saveThreshold()">SET GPS閾値</button>
    </div>

    <div class="form-group">
        <label for="lapCoolDownSelect">ラップクールダウン (秒):</label>
        <select name="coolDown" id="lapCoolDownSelect">
            <option value="20000">20秒</option>
            <option value="30000">30秒</option>
            <option value="40000">40秒</option>
            <option value="50000">50秒</option>
            <option value="60000">60秒</option>
            <option value="90000">90秒</option>
            <option value="122000">120秒</option>
            <option value="180000">180秒</option>
        </select>
        <p id="setLapCoolDown"></p>
    </div>

    <div class="form-group">
        <button onclick="saveLapCoolDown()">SET ラップクールダウン</button>
    </div>

    <div class="form-group">
        <button value="START" id="mybtn2">START</button>
    </div>

    <div class="form-group">
        <p id="clickCoordinates"></p>
    </div>

    <div class="form-group">
        <button id="resetStorageButton">Reset All Settings</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="circuit_data.js"></script>
    <script>
        // グローバル変数
        var map;
        var startPointMarker = null;
        var endPointMarker = null;
        var currentPositionMarker = null;
        var startLinePolyline = null; // スタートラインの線
        var pl1 = 1; // パルス数
        var cir1 = ""; // サーキット名
        var gpsThreshold = 20; // GPS閾値の初期値
        var lapCoolDownTime = 30000; // ラップクールダウン時間の初期値 (ミリ秒)

        // GPS更新頻度計測用の変数
        let lastTimestamp = 0;
        let watchId = null;

        // 地図の初期化（現在位置を使用）
        function initMap() {
            map = L.map('mapid');
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // 地図の初期位置を適当な場所に設定（watchPositionで更新される）
            map.setView([35.0, 139.0], 8);
        }

        // GPSの更新頻度と現在位置を監視する関数
        function startGpsFrequencyMonitor() {
            // watchPosition の成功時コールバック
            function watchSuccess(position) {
                const currentTimestamp = position.timestamp;
                
                // 最初のデータ受信時以外
                if (lastTimestamp !== 0) {
                    const elapsedTime = currentTimestamp - lastTimestamp;
                    // 更新頻度（Hz）を計算し、表示
                    const frequency = 1000 / elapsedTime;
                    document.getElementById('gps-frequency').textContent = frequency.toFixed(2);
                }
                
                lastTimestamp = currentTimestamp;

                // 地図上の現在地マーカーを更新
                const currentLatLng = L.latLng(position.coords.latitude, position.coords.longitude);
                if (currentPositionMarker) {
                    currentPositionMarker.setLatLng(currentLatLng);
                } else {
                    currentPositionMarker = L.marker(currentLatLng).addTo(map);
                    map.setView(currentLatLng, 16); // 初回取得時にズーム
                }
            }

            // watchPosition の失敗時コールバック
            function watchError(error) {
                console.error(`位置情報の取得エラー: ${error.code} - ${error.message}`);
                document.getElementById('gps-frequency').textContent = 'エラー';
            }

            // watchPosition で連続的な位置情報の監視を開始
            watchId = navigator.geolocation.watchPosition(watchSuccess, watchError, {
                // ここでオプションを設定
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            });
            console.log('GPS更新頻度の監視を開始しました。');
        }

        // マーカーのドラッグイベントハンドラ
        function onMarkerDragEnd(e) {
            const marker = e.target;
            const latlng = marker.getLatLng();

            if (marker === startPointMarker) {
                document.getElementById('startLineP1Lon').value = latlng.lng;
                document.getElementById('startLineP1Lat').value = latlng.lat;
                marker.setPopupContent('開始点<br>緯度: ' + latlng.lat.toFixed(6) + '<br>経度: ' + latlng.lng.toFixed(6)).openPopup();
                console.log('開始点をドラッグして更新しました:', latlng);
            } else if (marker === endPointMarker) {
                document.getElementById('startLineP2Lon').value = latlng.lng;
                document.getElementById('startLineP2Lat').value = latlng.lat;
                marker.setPopupContent('終了点<br>緯度: ' + latlng.lat.toFixed(6) + '<br>経度: ' + latlng.lng.toFixed(6)).openPopup();
                console.log('終了点をドラッグして更新しました:', latlng);
            }
            updateStartLinePolyline(); // 線を更新
        }

        // スタートラインの線を更新する関数
        function updateStartLinePolyline() {
            if (startLinePolyline) {
                map.removeLayer(startLinePolyline);
            }
            if (startPointMarker && endPointMarker) {
                const p1 = startPointMarker.getLatLng();
                const p2 = endPointMarker.getLatLng();
                startLinePolyline = L.polyline([p1, p2], { color: 'red', weight: 5, opacity: 0.7 }).addTo(map);
            }
        }

        // 「開始点を配置・ドラッグ」ボタンのイベントリスナー
        document.getElementById('setStartPointButton').addEventListener('click', function() {
            if (!startPointMarker) {
                const center = map.getCenter();
                startPointMarker = L.marker(center, { draggable: true }).addTo(map);
                startPointMarker.on('dragend', onMarkerDragEnd);
                document.getElementById('startLineP1Lon').value = center.lng;
                document.getElementById('startLineP1Lat').value = center.lat;
                startPointMarker.bindPopup('開始点<br>緯度: ' + center.lat.toFixed(6) + '<br>経度: ' + center.lng.toFixed(6)).openPopup();
            }
            map.setView(startPointMarker.getLatLng(), map.getZoom());
            document.getElementById('setEndPointButton').disabled = false;
            document.getElementById('instructionMessage').textContent = '開始点を地図上のマーカーをドラッグして設定してください。';
        });

        // 「終了点を配置・ドラッグ」ボタンのイベントリスナー
        document.getElementById('setEndPointButton').addEventListener('click', function() {
            if (!startPointMarker) {
                document.getElementById('instructionMessage').textContent = '先に開始点を配置してください。';
                return;
            }

            if (!endPointMarker) {
                const center = map.getCenter();
                endPointMarker = L.marker(center, { draggable: true }).addTo(map);
                endPointMarker.on('dragend', onMarkerDragEnd);
                document.getElementById('startLineP2Lon').value = center.lng;
                document.getElementById('startLineP2Lat').value = center.lat;
                endPointMarker.bindPopup('終了点<br>緯度: ' + center.lat.toFixed(6) + '<br>経度: ' + center.lng.toFixed(6)).openPopup();
            }
            map.setView(endPointMarker.getLatLng(), map.getZoom());
            updateStartLinePolyline();
            document.getElementById('instructionMessage').textContent = '終了点を地図上のマーカーをドラッグして設定してください。';
        });

        const circuitSelect = document.getElementById("circuitSelect");
        circuitSelect.addEventListener("change", function (e) {
            const stg = circuitSelect.value;
            const startLine = loadCircuitStartLineFromData(stg);
            document.getElementById('startLineP1Lon').value = startLine.p1[0];
            document.getElementById('startLineP1Lat').value = startLine.p1[1];
            document.getElementById('startLineP2Lon').value = startLine.p2[0];
            document.getElementById('startLineP2Lat').value = startLine.p2[1];
            cir1 = circuitData[stg]?.name || "";
            document.getElementById("setSportkk").textContent = cir1 || "未選択";
            document.getElementById('setEndPointButton').disabled = false;
            localStorage.setItem('cir1', cir1);

            const p1 = L.latLng(startLine.p1[1], startLine.p1[0]);
            const p2 = L.latLng(startLine.p2[1], startLine.p2[0]);
            
            if (startPointMarker) {
                map.removeLayer(startPointMarker);
                startPointMarker = null;
            }
            if (endPointMarker) {
                map.removeLayer(endPointMarker);
                endPointMarker = null;
            }

            startPointMarker = L.marker(p1, { draggable: true }).addTo(map)
                .bindPopup('開始点<br>緯度: ' + p1.lat.toFixed(6) + '<br>経度: ' + p1.lng.toFixed(6))
                .openPopup();
            startPointMarker.on('dragend', onMarkerDragEnd);

            endPointMarker = L.marker(p2, { draggable: true }).addTo(map)
                .bindPopup('終了点<br>緯度: ' + p2.lat.toFixed(6) + '<br>経度: ' + p2.lng.toFixed(6))
                .openPopup();
            endPointMarker.on('dragend', onMarkerDragEnd);

            updateStartLinePolyline();
            map.fitBounds(L.latLngBounds(p1, p2).pad(0.5));
        });

        function saveStartLineCoordinates() {
            const p1Lon = parseFloat(document.getElementById('startLineP1Lon').value);
            const p1Lat = parseFloat(document.getElementById('startLineP1Lat').value);
            const p2Lon = parseFloat(document.getElementById('startLineP2Lon').value);
            const p2Lat = parseFloat(document.getElementById('startLineP2Lat').value);

            if (!isNaN(p1Lon) && !isNaN(p1Lat) && !isNaN(p2Lon) && !isNaN(p2Lat)) {
                localStorage.setItem('startLineP1Lon', p1Lon);
                localStorage.setItem('startLineP1Lat', p1Lat);
                localStorage.setItem('startLineP2Lon', p2Lon);
                localStorage.setItem('startLineP2Lat', p2Lat);
                document.getElementById('instructionMessage').textContent = 'スタートライン座標を保存しました。';
                loadStoredStartLineCoordinates();
            } else {
                document.getElementById('instructionMessage').textContent = '正しい数値を入力してください。';
            }
        }

        const pulseCountSelect = document.getElementById("pulseCountSelect");
        pulseCountSelect.addEventListener("change", function (e) {
            pl1 = Number(pulseCountSelect.value);
            document.getElementById("setSportkkk").textContent = pl1;
            localStorage.setItem('pl1', pl1);
        });

        function savePulseCount() {
            localStorage.setItem('pl1', pl1);
            document.getElementById('instructionMessage').textContent = 'パルス数を保存しました: ' + pl1;
        }

        const thresholdSelect = document.getElementById("thresholdSelect");
        thresholdSelect.addEventListener("change", function (e) {
            gpsThreshold = Number(thresholdSelect.value);
            document.getElementById("setThresholdValue").textContent = gpsThreshold + "m";
            localStorage.setItem('gpsThreshold', gpsThreshold);
        });

        function saveThreshold() {
            localStorage.setItem('gpsThreshold', gpsThreshold);
            document.getElementById('instructionMessage').textContent = 'GPS閾値を保存しました: ' + gpsThreshold + "m";
        }

        const lapCoolDownSelect = document.getElementById("lapCoolDownSelect");
        lapCoolDownSelect.addEventListener("change", function (e) {
            lapCoolDownTime = Number(lapCoolDownSelect.value);
            document.getElementById("setLapCoolDown").textContent = (lapCoolDownTime / 1000) + "秒";
            localStorage.setItem('lapCoolDownTime', lapCoolDownTime);
        });

        function saveLapCoolDown() {
            localStorage.setItem('lapCoolDownTime', lapCoolDownTime);
            document.getElementById('instructionMessage').textContent = 'ラップクールダウンを保存しました: ' + (lapCoolDownTime / 1000) + "秒";
        }


        function loadStoredStartLineCoordinates() {
            const slP1Lon = localStorage.getItem('startLineP1Lon');
            const slP1Lat = localStorage.getItem('startLineP1Lat');
            const slP2Lon = localStorage.getItem('startLineP2Lon');
            const slP2Lat = localStorage.getItem('startLineP2Lat');

            document.getElementById('startLineP1Lon').value = slP1Lon || '';
            document.getElementById('startLineP1Lat').value = slP1Lat || '';
            document.getElementById('startLineP2Lon').value = slP2Lon || '';
            document.getElementById('startLineP2Lat').value = slP2Lat || '';

            if (slP1Lon && slP1Lat && slP2Lon && slP2Lat) {
                const p1 = L.latLng(parseFloat(slP1Lat), parseFloat(slP1Lon));
                const p2 = L.latLng(parseFloat(slP2Lat), parseFloat(slP2Lon));
                document.getElementById('setEndPointButton').disabled = false;

                if (startPointMarker) {
                    map.removeLayer(startPointMarker);
                    startPointMarker = null;
                }
                if (endPointMarker) {
                    map.removeLayer(endPointMarker);
                    endPointMarker = null;
                }

                startPointMarker = L.marker(p1, { draggable: true }).addTo(map)
                    .bindPopup('保存された開始点<br>緯度: ' + p1.lat.toFixed(6) + '<br>経度: ' + p1.lng.toFixed(6))
                    .openPopup();
                startPointMarker.on('dragend', onMarkerDragEnd);

                endPointMarker = L.marker(p2, { draggable: true }).addTo(map)
                    .bindPopup('保存された終了点<br>緯度: ' + p2.lat.toFixed(6) + '<br>経度: ' + p2.lng.toFixed(6))
                    .openPopup();
                endPointMarker.on('dragend', onMarkerDragEnd);

                updateStartLinePolyline();
                console.log('保存されたスタートライン座標を読み込みました:', p1, p2);
            } else {
                document.getElementById('setEndPointButton').disabled = true;
                if (startPointMarker) {
                    map.removeLayer(startPointMarker);
                    startPointMarker = null;
                }
                if (endPointMarker) {
                    map.removeLayer(endPointMarker);
                    endPointMarker = null;
                }
                if (startLinePolyline) {
                    map.removeLayer(startLinePolyline);
                    startLinePolyline = null;
                }
                console.log('localStorageにスタートライン座標は保存されていません。');
            }
        }

        function loadStoredPulseCount() {
            const storedPulseCount = localStorage.getItem('pl1');
            if (storedPulseCount) {
                pl1 = Number(storedPulseCount);
                document.getElementById("pulseCountSelect").value = storedPulseCount;
                document.getElementById("setSportkkk").textContent = pl1;
                console.log('保存されたパルス数を読み込みました:', pl1);
            } else {
                pl1 = 1;
                document.getElementById("pulseCountSelect").value = 1;
                document.getElementById("setSportkkk").textContent = pl1;
                console.log('localStorageにパルス数は保存されていません。デフォルト値を設定しました:', pl1);
            }
        }

        function loadStoredThreshold() {
            const storedThreshold = localStorage.getItem('gpsThreshold');
            if (storedThreshold) {
                gpsThreshold = Number(storedThreshold);
                document.getElementById("thresholdSelect").value = storedThreshold;
                document.getElementById("setThresholdValue").textContent = gpsThreshold + "m";
                console.log('保存されたGPS閾値を読み込みました:', gpsThreshold);
            } else {
                gpsThreshold = 20;
                document.getElementById("thresholdSelect").value = 20;
                document.getElementById("setThresholdValue").textContent = gpsThreshold + "m";
                console.log('localStorageにGPS閾値は保存されていません。デフォルト値を設定しました:', gpsThreshold);
            }
        }

        function loadStoredLapCoolDown() {
            const storedLapCoolDown = localStorage.getItem('lapCoolDownTime');
            if (storedLapCoolDown) {
                lapCoolDownTime = Number(storedLapCoolDown);
                document.getElementById("lapCoolDownSelect").value = storedLapCoolDown;
                document.getElementById("setLapCoolDown").textContent = (lapCoolDownTime / 1000) + "秒";
                console.log('保存されたラップクールダウンを読み込みました:', lapCoolDownTime);
            } else {
                lapCoolDownTime = 30000;
                document.getElementById("lapCoolDownSelect").value = 30000;
                document.getElementById("setLapCoolDown").textContent = (lapCoolDownTime / 1000) + "秒";
                console.log('localStorageにラップクールダウンは保存されていません。デフォルト値を設定しました:', lapCoolDownTime);
            }
        }


        function loadStoredCircuit() {
            const storedCircuit = localStorage.getItem('cir1');
            const circuitSelectElement = document.getElementById("circuitSelect");
            if (storedCircuit) {
                cir1 = storedCircuit;
                const optionToSelect = Array.from(circuitSelectElement.options).find(option => option.text === storedCircuit);
                if (optionToSelect) {
                    circuitSelectElement.value = optionToSelect.value;
                    document.getElementById("setSportkk").textContent = cir1;
                    document.getElementById('setEndPointButton').disabled = false;
                } else {
                    circuitSelectElement.value = "";
                    document.getElementById("setSportkk").textContent = "未選択";
                }
                console.log('保存されたサーキット名を読み込みました:', cir1);
            } else {
                circuitSelectElement.value = "";
                document.getElementById("setSportkk").textContent = "未選択";
                console.log('localStorageにサーキット名は保存されていません。');
            }
        }

        function loadCircuitStartLineFromData(circuitId) {
            // この関数は circuit_data.js からデータを読み込むことを想定しています。
            if (circuitData && circuitData[circuitId]) {
                return {
                    p1: circuitData[circuitId].startLineP1,
                    p2: circuitData[circuitId].startLineP2
                };
            } else {
                return { p1: [0, 0], p2: [0, 0] };
            }
        }

        let button2 = document.getElementById('mybtn2');
        button2.addEventListener('click', () => {
            open('test3_4_ana_666.html');
        });

        // Function to reset all stored data and update UI
        function resetStorageAndDisplay() {
            // confirm() の代わりにカスタムモーダルを使うことが推奨されます
            if (confirm('すべての保存された設定をリセットしてもよろしいですか？')) {
                localStorage.removeItem('startLineP1Lon');
                localStorage.removeItem('startLineP1Lat');
                localStorage.removeItem('startLineP2Lon');
                localStorage.removeItem('startLineP2Lat');
                localStorage.removeItem('pl1');
                localStorage.removeItem('cir1');
                localStorage.removeItem('gpsThreshold');
                localStorage.removeItem('lapCoolDownTime');

                document.getElementById('startLineP1Lon').value = '';
                document.getElementById('startLineP1Lat').value = '';
                document.getElementById('startLineP2Lon').value = '';
                document.getElementById('startLineP2Lat').value = '';

                document.getElementById("circuitSelect").value = "";
                document.getElementById("setSportkk").textContent = "未選択";
                document.getElementById("pulseCountSelect").value = "1";
                document.getElementById("setSportkkk").textContent = "1";
                document.getElementById("thresholdSelect").value = "20";
                document.getElementById("setThresholdValue").textContent = "20m";
                document.getElementById("lapCoolDownSelect").value = "30000";
                document.getElementById("setLapCoolDown").textContent = "30秒";
                document.getElementById('clickCoordinates').textContent = '';
                document.getElementById('instructionMessage').textContent = 'すべての設定がリセットされました。';
                document.getElementById('setEndPointButton').disabled = true;

                if (startPointMarker) {
                    map.removeLayer(startPointMarker);
                    startPointMarker = null;
                }
                if (endPointMarker) {
                    map.removeLayer(endPointMarker);
                    endPointMarker = null;
                }
                if (startLinePolyline) {
                    map.removeLayer(startLinePolyline);
                    startLinePolyline = null;
                }
                console.log('All stored data has been reset.');
            }
        }

        // Attach event listener to the reset button
        document.getElementById('resetStorageButton').addEventListener('click', resetStorageAndDisplay);

        // ページ読み込み時の処理
        window.onload = function () {
            initMap();
            startGpsFrequencyMonitor();
            loadStoredStartLineCoordinates();
            loadStoredPulseCount();
            loadStoredCircuit();
            loadStoredThreshold();
            loadStoredLapCoolDown();
        };
    </script>
</body>
</html>
